<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Export Test Runner</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #1a1a1a;
      border-bottom: 3px solid #8b5cf6;
      padding-bottom: 10px;
    }
    #console {
      background: #1a1a1a;
      color: #00ff00;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      min-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-top: 20px;
    }
    .success { color: #10b981; }
    .error { color: #ef4444; }
    .info { color: #3b82f6; }
    .warning { color: #f59e0b; }
    button {
      background: #8b5cf6;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover {
      background: #7c3aed;
    }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .test-info {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>üìÑ PDF Export Test Runner</h1>
  
  <div class="test-info">
    <h2>Vietnamese Text Export Test</h2>
    <p>Dieser Test exportiert vietnamesischen Text in einer Tabelle zu PDF.</p>
    <p><strong>Test-Inhalt:</strong></p>
    <ul>
      <li>3 Steps mit vietnamesischen Beschreibungen</li>
      <li>5 Tabellenzeilen mit deutschen und vietnamesischen Texten</li>
      <li>Testet die korrekte Darstellung der NotoSansVietnamese Font</li>
    </ul>
  </div>

  <button id="runTest" onclick="runTests()">‚ñ∂ Test starten</button>
  <button onclick="clearConsole()">üóëÔ∏è Console leeren</button>

  <div id="console"></div>

  <script type="module">
    import { PDFExportService } from './services/pdfExportService.ts';

    let consoleDiv;

    function log(message, className = '') {
      if (!consoleDiv) consoleDiv = document.getElementById('console');
      const line = document.createElement('div');
      line.className = className;
      line.textContent = message;
      consoleDiv.appendChild(line);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    window.clearConsole = function() {
      if (!consoleDiv) consoleDiv = document.getElementById('console');
      consoleDiv.innerHTML = '';
    }

    function createVietnameseTableTask() {
      return {
        id: `vietnamese-test-${Date.now()}`,
        pageNumber: 1,
        grade: 'Klasse 5',
        subject: 'Deutsch',
        subSubject: 'Grammatik',
        taskTitle: 'das/dass √úbung',
        taskDescription_de: '√úbung zu das/dass mit vietnamesischen Erkl√§rungen',
        taskDescription_vi: 'B√†i t·∫≠p v·ªÅ das/dass v·ªõi gi·∫£i th√≠ch ti·∫øng Vi·ªát',
        steps: [
          {
            title_de: 'Lerne die Ersetzungsmethode',
            title_vi: 'H·ªçc c√°ch th·ª≠ thay th·∫ø',
            description_de: 'Verwende "das" mit einem s, wenn du es durch "dieses", "jenes" oder "welches" ersetzen kannst.',
            description_vi: "S·ª≠ d·ª•ng 'das' v·ªõi m·ªôt ch·ªØ 's' khi b·∫°n c√≥ th·ªÉ thay th·∫ø n√≥ b·∫±ng 'dieses', 'jenes' ho·∫∑c 'welches'."
          },
          {
            title_de: 'Erkenne die Konjunktion',
            title_vi: 'Nh·∫≠n bi·∫øt li√™n t·ª´',
            description_de: 'Schreibe "dass" mit zwei s, wenn es einen Nebensatz einleitet und nicht ersetzt werden kann.',
            description_vi: "Vi·∫øt 'dass' v·ªõi hai ch·ªØ 's' khi n√≥ b·∫Øt ƒë·∫ßu m·ªôt m·ªánh ƒë·ªÅ ph·ª• v√† kh√¥ng th·ªÉ thay th·∫ø ƒë∆∞·ª£c."
          },
          {
            title_de: 'Korrigiere den Text',
            title_vi: 'S·ª≠a l·ªói ƒëo·∫°n vƒÉn',
            description_de: 'Lies den Text sorgf√§ltig und pr√ºfe jedes "das/dass", ob die Regel eingehalten wurde.',
            description_vi: 'ƒê·ªçc k·ªπ ƒëo·∫°n vƒÉn v√† ki·ªÉm tra t·ª´ng t·ª´ "das/dass" xem quy t·∫Øc ƒë√£ ƒë∆∞·ª£c tu√¢n th·ªß ch∆∞a.'
          }
        ],
        solutionTable: [
          {
            taskNumber: '1',
            label_de: 'Unterst√ºtzung',
            label_vi: 'H·ªó tr·ª£',
            value_de: 'Lerne die Ersetzungsmethode',
            value_vi: 'H·ªçc c√°ch th·ª≠ thay th·∫ø'
          },
          {
            taskNumber: '2',
            label_de: 'Regel "das"',
            label_vi: 'Quy t·∫Øc "das"',
            value_de: 'Verwende "das" mit einem s, wenn du es durch "dieses", "jenes" oder "welches" ersetzen kannst.',
            value_vi: "S·ª≠ d·ª•ng 'das' v·ªõi m·ªôt ch·ªØ 's' khi b·∫°n c√≥ th·ªÉ thay th·∫ø n√≥ b·∫±ng 'dieses', 'jenes' ho·∫∑c 'welches'."
          },
          {
            taskNumber: '3',
            label_de: 'Regel "dass"',
            label_vi: 'Quy t·∫Øc "dass"',
            value_de: 'Schreibe "dass" mit zwei s, wenn es einen Nebensatz einleitet und nicht ersetzt werden kann.',
            value_vi: "Vi·∫øt 'dass' v·ªõi hai ch·ªØ 's' khi n√≥ b·∫Øt ƒë·∫ßu m·ªôt m·ªánh ƒë·ªÅ ph·ª• v√† kh√¥ng th·ªÉ thay th·∫ø ƒë∆∞·ª£c."
          },
          {
            taskNumber: '4',
            label_de: 'Aufgabe',
            label_vi: 'Nhi·ªám v·ª•',
            value_de: 'Lies den Text sorgf√§ltig und pr√ºfe jedes "das/dass", ob die Regel eingehalten wurde.',
            value_vi: 'ƒê·ªçc k·ªπ ƒëo·∫°n vƒÉn v√† ki·ªÉm tra t·ª´ng t·ª´ "das/dass" xem quy t·∫Øc ƒë√£ ƒë∆∞·ª£c tu√¢n th·ªß ch∆∞a.'
          },
          {
            taskNumber: '5',
            label_de: 'Aktion',
            label_vi: 'H√†nh ƒë·ªông',
            value_de: 'Lege los',
            value_vi: 'lege los'
          }
        ],
        finalSolution_de: 'Die √úbung testet das Verst√§ndnis der das/dass Regel.',
        finalSolution_vi: 'B√†i t·∫≠p ki·ªÉm tra s·ª± hi·ªÉu bi·∫øt v·ªÅ quy t·∫Øc das/dass.',
        teacherSection: {
          learningGoal_de: 'Sch√ºler k√∂nnen zwischen "das" und "dass" unterscheiden',
          studentSteps_de: [
            'Ersetzungsmethode anwenden',
            'Konjunktion erkennen',
            'Text korrigieren'
          ],
          explanation_de: 'Diese √úbung hilft beim Verst√§ndnis der das/dass Unterscheidung',
          summary_de: 'Wichtige Rechtschreibregel f√ºr deutsche Grammatik'
        },
        timestamp: Date.now(),
        isTestData: true
      };
    }

    window.runTests = async function() {
      const button = document.getElementById('runTest');
      button.disabled = true;
      clearConsole();

      log('üìÑ PDF Export Test Suite', 'info');
      log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'info');
      log('');

      try {
        log('üîÑ Erstelle Test-Task mit vietnamesischem Text...', 'info');
        const testTask = createVietnameseTableTask();
        
        log('‚úÖ Test-Task erstellt', 'success');
        log(`   - Titel: ${testTask.taskTitle}`, 'info');
        log(`   - Steps: ${testTask.steps.length}`, 'info');
        log(`   - Tabellenzeilen: ${testTask.solutionTable.length}`, 'info');
        log('');

        log('üîÑ Exportiere zu PDF...', 'info');
        const startTime = Date.now();
        
        await PDFExportService.exportToPDF([testTask], (current, total) => {
          log(`   Fortschritt: ${current}/${total}`, 'info');
        });
        
        const duration = Date.now() - startTime;
        log('');
        log('‚úÖ PDF erfolgreich erstellt!', 'success');
        log(`   - Dauer: ${duration}ms`, 'info');
        log(`   - Dateiname: das_dass_Ubung.pdf`, 'success');
        log(`   - Speicherort: Downloads-Ordner`, 'info');
        log('');
        
        log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'info');
        log('üéâ Test erfolgreich abgeschlossen!', 'success');
        log('');
        log('üìã √úberpr√ºfe bitte manuell:', 'warning');
        log('   1. √ñffne die PDF-Datei aus deinem Downloads-Ordner', 'warning');
        log('   2. Pr√ºfe, ob vietnamesische Zeichen korrekt angezeigt werden', 'warning');
        log('   3. Achte besonders auf die Tabelle mit den 5 Zeilen', 'warning');
        
      } catch (error) {
        log('', 'error');
        log('‚ùå Test fehlgeschlagen:', 'error');
        log(error.message, 'error');
        if (error.stack) {
          log('Stack Trace:', 'error');
          log(error.stack, 'error');
        }
      } finally {
        button.disabled = false;
      }
    };

    // Auto-start wenn gew√ºnscht
    // window.addEventListener('load', () => runTests());
  </script>
</body>
</html>
